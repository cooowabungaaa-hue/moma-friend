<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇÇ„Åæ„Å°„ÇÉ„Çì„ÅÆ„ÅäÈÉ®Â±ã - Moma's Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            overflow: hidden;
        }

        #room-container {
            width: 100vw;
            height: 100vh;
            background-image: url('./room-bg.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        /* Moma-chan Character */
        #moma-character {
            position: absolute;
            width: 250px;
            height: auto;
            transition: top 3s ease-in-out, left 3s ease-in-out, transform 0.3s;
            cursor: pointer;
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.1));
            z-index: 10;
        }

        /* Breathing Animation */
        .breathe {
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Walking Animation (bobbing) */
        .walk {
            animation: walk 0.5s ease-in-out infinite;
        }

        @keyframes walk {

            0%,
            100% {
                transform: translateY(0) rotate(-2deg);
            }

            50% {
                transform: translateY(-10px) rotate(2deg);
            }
        }

        /* Heart Bubble */
        .heart-bubble {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 20;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(0);
                opacity: 0;
            }

            20% {
                transform: translateY(-10px) scale(1.2);
                opacity: 1;
            }

            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        /* UI Controls */
        .ui-panel {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 9999px;
            display: flex;
            gap: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            z-index: 30;
        }

        button.action-btn {
            font-size: 1.5rem;
            padding: 0.5rem;
            border-radius: 50%;
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #E0BBE4;
            transition: all 0.2s;
        }

        button.action-btn:hover {
            transform: scale(1.1);
            background: #FEC8D8;
        }
    </style>
</head>

<body>

    <div id="room-container">
        <!-- Moma-chan -->
        <div id="moma-character" class="breathe" onclick="petMoma()">
            <img id="moma-img" src="./moma-idle.png" alt="Moma-chan" style="width: 100%; pointer-events: none;">
        </div>

        <!-- UI Controls (Tamagotchi Style) -->
        <div class="ui-panel">
            <button class="action-btn" onclick="feedMoma()" title="„Åî„ÅØ„Çì">ü•™</button>
            <button class="action-btn" onclick="playBall()" title="„ÅÇ„Åù„Å∂">üéæ</button>
            <button class="action-btn" onclick="sleepMoma()" title="„Å≠„Çã">üåô</button>
            <a href="index.html" class="action-btn bg-slate-100" title="„ÇÇ„Å©„Çã">üè†</a>
        </div>
    </div>

    <script>
        const moma = document.getElementById('moma-character');
        const momaImg = document.getElementById('moma-img');
        const container = document.getElementById('room-container');

        let state = 'IDLE'; // IDLE, WALKING, EATING, SLEEPING
        let width = container.offsetWidth;
        let height = container.offsetHeight;
        let momaX = width / 2 - 125;
        let momaY = height / 2 + 100;

        // Initialize Position
        updatePosition();
        setState('IDLE'); // Ensure initial state is set correctly with image

        function setState(newState) {
            state = newState;

            // Reset animations that might conflict (keep position transitions)
            moma.classList.remove('walk', 'breathe');

            // Set Image and Animation based on State
            switch (state) {
                case 'IDLE':
                    momaImg.src = './moma-idle.png';
                    moma.classList.add('breathe');
                    break;
                case 'WALKING':
                    momaImg.src = './moma-walk.png';
                    moma.classList.add('walk');
                    break;
                case 'EATING':
                    momaImg.src = './moma-eat.png';
                    moma.classList.add('breathe');
                    break;
                case 'SLEEPING':
                    momaImg.src = './moma-sleep.png';
                    moma.classList.add('breathe');
                    break;
            }
        }

        // Game Loop for autonomous behavior
        setInterval(() => {
            if (state === 'SLEEPING') return;

            // Random chance to change behavior
            if (Math.random() < 0.05) { // 5% chance every second to pick new action
                decideAction();
            }
        }, 1000);

        function decideAction() {
            if (state === 'EATING') return;

            const rand = Math.random();
            if (rand < 0.6) {
                // Walk to new random position
                walkToRandomSpot();
            } else {
                // Idle
                setState('IDLE');
            }
        }

        function walkToRandomSpot() {
            setState('WALKING');

            // Define walkable area (bottom half of screen mostly)
            const targetX = Math.random() * (width - 300); // keep padding
            const targetY = (height / 2) + (Math.random() * (height / 2 - 300));

            // Face direction
            if (targetX > momaX) {
                moma.style.transform = "scaleX(-1)"; // Face Right
            } else {
                moma.style.transform = "scaleX(1)"; // Face Left
            }

            momaX = targetX;
            momaY = targetY;
            updatePosition();

            // After move duration (CSS transition 3s), go back to Idle
            setTimeout(() => {
                if (state === 'WALKING') {
                    setState('IDLE');
                }
            }, 3000);
        }

        function updatePosition() {
            moma.style.left = momaX + 'px';
            moma.style.top = momaY + 'px';
        }

        function petMoma() {
            if (state === 'SLEEPING') {
                createHeart(momaX + 125, momaY, "üí§");
                return;
            }
            // Reaction
            moma.classList.add('animate-bounce'); // Tailwind bouce
            createHeart(momaX + 125, momaY);
            setTimeout(() => moma.classList.remove('animate-bounce'), 1000);
        }

        function feedMoma() {
            if (state === 'SLEEPING') return;
            setState('EATING');
            createHeart(momaX + 125, momaY - 50, "ü•™");
            // Jump to center maybe? Or just eat where is
            setTimeout(() => {
                createHeart(momaX + 125, momaY - 50, "‚ù§Ô∏è");
                createHeart(momaX + 150, momaY - 80, "üòã");
                setState('IDLE');
            }, 2000);
        }

        function playBall() {
            if (state === 'SLEEPING') return;
            createHeart(momaX + 125, momaY - 50, "üéµ");
            walkToRandomSpot(); // Excitement
        }

        function sleepMoma() {
            if (state === 'SLEEPING') {
                // Wake up
                setState('IDLE');
                moma.style.filter = "drop-shadow(0 10px 15px rgba(0,0,0,0.1))"; // restore brightness
                createHeart(momaX + 125, momaY - 50, "‚òÄÔ∏è");
            } else {
                setState('SLEEPING');
                moma.style.filter = "brightness(0.8) sepia(0.2)"; // Sleepy look
                createHeart(momaX + 125, momaY - 50, "üí§");
            }
        }

        function createHeart(x, y, char = "‚ù§Ô∏è") {
            const heart = document.createElement('div');
            heart.classList.add('heart-bubble');
            heart.innerText = char;
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        // Handle Window Resize
        window.addEventListener('resize', () => {
            width = container.offsetWidth;
            height = container.offsetHeight;
        });
    </script>
</body>

</html>