<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇÇ„Åæ„Å°„ÇÉ„Çì„ÅÆ„ÅäÈÉ®Â±ã - Moma's Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            overflow: hidden;
        }

        #room-container {
            width: 100vw;
            height: 100vh;
            background-image: url('./room-bg.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        /* Moma-chan Character */
        #moma-character {
            position: absolute;
            width: 250px;
            height: auto;
            transition: top 3s ease-in-out, left 3s ease-in-out, transform 0.3s;
            cursor: pointer;
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.1));
            z-index: 10;
        }

        /* Breathing Animation */
        .breathe {
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Walking Animation (bobbing) */
        .walk {
            animation: walk 0.5s ease-in-out infinite;
        }

        @keyframes walk {

            0%,
            100% {
                transform: translateY(0) rotate(-2deg);
            }

            50% {
                transform: translateY(-10px) rotate(2deg);
            }
        }

        /* Heart Bubble */
        .heart-bubble {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 20;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(0);
                opacity: 0;
            }

            20% {
                transform: translateY(-10px) scale(1.2);
                opacity: 1;
            }

            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        /* UI Controls */
        .ui-panel {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 9999px;
            display: flex;
            gap: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            z-index: 30;
        }

        button.action-btn {
            font-size: 1.5rem;
            padding: 0.5rem;
            border-radius: 50%;
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #E0BBE4;
            transition: all 0.2s;
        }

        button.action-btn:hover {
            transform: scale(1.1);
            background: #FEC8D8;
        }

        /* Amoeba Topic Menu */
        #topic-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 240, 245, 0.9);
            display: none;
            /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .topic-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            margin-bottom: 40px;
        }

        .amoeba-btn {
            background: white;
            border: 3px solid #FFDEE9;
            padding: 20px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff69b4;
            cursor: pointer;
            transition: all 0.5s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;

            /* Amoeba Shape */
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            animation: morph 8s ease-in-out infinite, float 4s ease-in-out infinite;
        }

        .amoeba-btn:nth-child(even) {
            border-radius: 30% 70% 70% 30% / 50% 60% 40% 50%;
            animation-delay: -2s;
        }

        .amoeba-btn:hover {
            transform: scale(1.1);
            background: #FFE4E1;
            border-color: #FFB6C1;
        }

        @keyframes morph {
            0% {
                border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            }

            50% {
                border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
            }

            100% {
                border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        #moma-look-up {
            width: 200px;
            animation: sway 3s ease-in-out infinite;
        }

        @keyframes sway {

            0%,
            100% {
                transform: rotate(-5deg);
            }

            50% {
                transform: rotate(5deg);
            }
        }

        /* Speech Bubble */
        .speech-bubble {
            position: absolute;
            background: white;
            border-radius: 20px;
            padding: 15px 25px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            z-index: 50;
            display: none;
            max-width: 250px;
            text-align: center;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: white transparent transparent;
        }

        /* Chat Input Container */
        .chat-input-container {
            margin-top: 20px;
            display: none;
            /* Hidden until topic selected */
            gap: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 999px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            align-items: center;
        }

        .back-btn {
            background: #eee;
            border: none;
            padding: 5px 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8rem;
        }

        #user-input {
            border: none;
            outline: none;
            flex-grow: 1;
            font-size: 1rem;
            color: #333;
        }

        .send-btn {
            background: #FFB6C1;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 999px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #FF69B4;
        }
    </style>
</head>

<body>

    <div id="room-container">
        <!-- Moma-chan -->
        <div id="moma-character" class="breathe" onclick="petMoma()">
            <img id="moma-img" src="./moma-idle.png" alt="Moma-chan" style="width: 100%; pointer-events: none;">
        </div>

        <!-- UI Controls (Tamagotchi Style) -->
        <div class="ui-panel">
            <button class="action-btn" onclick="feedMoma()" title="„Åî„ÅØ„Çì">ü•™</button>
            <button class="action-btn" onclick="playBall()" title="„ÅÇ„Åù„Å∂">üéæ</button>
            <button class="action-btn" onclick="openChat()" title="„Åä„ÅØ„Å™„Åó">üí¨</button>
            <button class="action-btn" onclick="sleepMoma()" title="„Å≠„Çã">üåô</button>
            <a href="index.html" class="action-btn bg-slate-100" title="„ÇÇ„Å©„Çã">üè†</a>
        </div>

        <!-- Topic Menu -->
        <div id="topic-menu" onclick="closeChat(event)">
            <div class="topic-container" id="menu-topics" onclick="event.stopPropagation()">
                <button class="amoeba-btn" onclick="selectTopic('„Åä„ÇÑ„Å§')">„Åä„ÇÑ„Å§üç≠</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åä„ÅÑ„Åó„ÅÑ„ÇÇ„ÅÆ')">„Åä„ÅÑ„Åó„ÅÑ„ÇÇ„ÅÆüòã</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åì„Çå„Åô„Åç')">„Åì„Çå„Åô„Åç‚ù§Ô∏è</button>
                <button class="amoeba-btn" onclick="selectTopic('„Å§„Åæ„Çì„Å™„ÅÑ')">„Å§„Åæ„Çì„Å™„ÅÑüí§</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åü„ÅÆ„ÅóÔΩû')">„Åü„ÅÆ„Åó„Äú‚ú®</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åì„Çè„ÅÑ')">„Åì„Çè„ÅÑüíß</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åç„ÅÑ„Å¶ÔºÅ')">„Åç„ÅÑ„Å¶ÔºÅüì¢</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åä„Åï„Çì„ÅΩ')">„Åä„Åï„Çì„ÅΩüêæ</button>
                <button class="amoeba-btn" onclick="selectTopic('„Å†„ÅÑ„Åô„Åç')">„Å†„ÅÑ„Åô„Åçüíï</button>
                <button class="amoeba-btn" onclick="selectTopic('„Å™„ÅÑ„Åó„ÇáË©±')">„Å™„ÅÑ„Åó„ÇáË©±ü§´</button>
                <button class="amoeba-btn" onclick="selectTopic('„Åä„Å™„Åã„Å∏„Å£„Åü')">„Åä„Å™„Åã„Å∏„Å£„Åüüçö</button>
                <button class="amoeba-btn" onclick="selectTopic('„Å™„Å´È£ü„Åπ„Çà„Å£„ÅãÔΩû', true)">„Å™„Å´È£ü„Åπ„Çà„Å£„ÅãÔΩûüç¥</button>
            </div>

            <div class="chat-input-container" id="menu-input" onclick="event.stopPropagation()">
                <button class="back-btn" onclick="showTopics()">‚Üê</button>
                <input type="text" id="user-input" placeholder="„ÇÇ„Åæ„Å°„ÇÉ„Çì„Å´„Å™„Å´„ÅãË©±„Åó„Å¶..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendChat()">ÈÄÅ‰ø°</button>
            </div>

            <p id="menu-instruction" class="mt-4 text-pink-400 font-bold">„Å©„ÅÆ„Åä„ÅØ„Å™„Åó„Å´„Åô„ÇãÔºü</p>
            <img src="./moma-idle.png" id="moma-look-up" alt="looking up moma">
        </div>

        <!-- Response Bubble -->
        <div id="moma-bubble" class="speech-bubble"></div>
    </div>

    <script>
        const moma = document.getElementById('moma-character');
        const momaImg = document.getElementById('moma-img');
        const container = document.getElementById('room-container');

        let state = 'IDLE'; // IDLE, WALKING, EATING, SLEEPING
        let width = container.offsetWidth;
        let height = container.offsetHeight;
        let momaX = width / 2 - 125;
        let momaY = height / 2 + 100;

        // Initialize Position
        updatePosition();
        setState('IDLE'); // Ensure initial state is set correctly with image

        function setState(newState) {
            state = newState;

            // Reset animations that might conflict (keep position transitions)
            moma.classList.remove('walk', 'breathe');

            // Set Image and Animation based on State
            switch (state) {
                case 'IDLE':
                    momaImg.src = './moma-idle.png';
                    moma.classList.add('breathe');
                    break;
                case 'WALKING':
                    momaImg.src = './moma-walk.png';
                    moma.classList.add('walk');
                    break;
                case 'EATING':
                    momaImg.src = './moma-eat.png';
                    moma.classList.add('breathe');
                    break;
                case 'SLEEPING':
                    momaImg.src = './moma-sleep.png';
                    moma.classList.add('breathe');
                    break;
            }
        }

        // Game Loop for autonomous behavior
        setInterval(() => {
            if (state === 'SLEEPING') return;

            // Random chance to change behavior
            if (Math.random() < 0.05) { // 5% chance every second to pick new action
                decideAction();
            }
        }, 1000);

        function decideAction() {
            if (state === 'EATING') return;

            const rand = Math.random();
            if (rand < 0.6) {
                // Walk to new random position
                walkToRandomSpot();
            } else {
                // Idle
                setState('IDLE');
            }
        }

        function walkToRandomSpot() {
            setState('WALKING');

            // Define walkable area (bottom half of screen mostly)
            const targetX = Math.random() * (width - 300); // keep padding
            const targetY = (height / 2) + (Math.random() * (height / 2 - 300));

            // Face direction
            if (targetX > momaX) {
                moma.style.transform = "scaleX(-1)"; // Face Right
            } else {
                moma.style.transform = "scaleX(1)"; // Face Left
            }

            momaX = targetX;
            momaY = targetY;
            updatePosition();

            // After move duration (CSS transition 3s), go back to Idle
            setTimeout(() => {
                if (state === 'WALKING') {
                    setState('IDLE');
                }
            }, 3000);
        }

        function updatePosition() {
            moma.style.left = momaX + 'px';
            moma.style.top = momaY + 'px';
        }

        function petMoma() {
            if (state === 'SLEEPING') {
                createHeart(momaX + 125, momaY, "üí§");
                return;
            }
            // Reaction
            moma.classList.add('animate-bounce'); // Tailwind bouce
            createHeart(momaX + 125, momaY);
            setTimeout(() => moma.classList.remove('animate-bounce'), 1000);
        }

        function feedMoma() {
            if (state === 'SLEEPING') return;
            setState('EATING');
            createHeart(momaX + 125, momaY - 50, "ü•™");
            // Jump to center maybe? Or just eat where is
            setTimeout(() => {
                createHeart(momaX + 125, momaY - 50, "‚ù§Ô∏è");
                createHeart(momaX + 150, momaY - 80, "üòã");
                setState('IDLE');
            }, 2000);
        }

        function playBall() {
            if (state === 'SLEEPING') return;
            createHeart(momaX + 125, momaY - 50, "üéµ");
            walkToRandomSpot(); // Excitement
        }

        function sleepMoma() {
            if (state === 'SLEEPING') {
                // Wake up
                setState('IDLE');
                moma.style.filter = "drop-shadow(0 10px 15px rgba(0,0,0,0.1))"; // restore brightness
                createHeart(momaX + 125, momaY - 50, "‚òÄÔ∏è");
            } else {
                setState('SLEEPING');
                moma.style.filter = "brightness(0.8) sepia(0.2)"; // Sleepy look
                createHeart(momaX + 125, momaY - 50, "üí§");
            }
        }

        // --- Chat Functions ---
        const topicMenu = document.getElementById('topic-menu');
        const menuTopics = document.getElementById('menu-topics');
        const menuInput = document.getElementById('menu-input');
        const menuInstruction = document.getElementById('menu-instruction');
        const momaBubble = document.getElementById('moma-bubble');
        const userInput = document.getElementById('user-input');

        let currentTopic = '';

        function openChat() {
            if (state === 'SLEEPING') return;
            showTopics();
            topicMenu.style.display = 'flex';
        }

        function showTopics() {
            currentTopic = '';
            menuTopics.style.display = 'flex';
            menuInput.style.display = 'none';
            menuInstruction.innerText = '„Å©„ÅÆ„Åä„ÅØ„Å™„Åó„Å´„Åô„ÇãÔºü';
            userInput.value = '';
        }

        const mealSuggestions = [
            'ÂêâÁâõ„ÅÆÊñ∞„É°„Éã„É•„Éº„ÅÇ„Çã„ÇÇ„ÅæÔºü',
            '„ÇÇ„Åæ„Å°„ÇÉ„Çì„ÅØ„Éû„ÉÉ„ÇØË°å„Åç„Åü„ÅÑ„ÇÇ„ÅæÔΩû',
            'Â∏∞„Çä„Å´„Éû„ÉÉ„ÇØ„Éï„É´„Éº„É™„Éº„ÇÇ„Åü„Åπ„Åü„ÅÑ„ÇÇ„Åæ„Å≠',
            '„Åä„Åì„ÅÆ„Åø„ÇÑ„ÅçÊúÄËøë„Åü„Åπ„Å¶„Å™„ÅÑ„ÇÇ„ÅæÔΩû',
            '„Å≥„Å£„Åè„Çä„Éâ„É≥„Ç≠„Éº„ÅÆ„Éè„É≥„Éê„Éº„Ç∞„Å´„Åô„Çã„ÇÇ„ÅæÔºü',
            '‰∏∏‰∫ÄË£ΩÈ∫∫„Åß„ÅÜ„Å©„Çì„Å§„Çã„Å§„Çã„Åó„Åü„ÅÑ„ÇÇ„Åæ„Å≠„Åá‚ú®',
            '„Çµ„Ç§„Çº„É™„É§„ÅÆ„Éü„É©„ÉéÈ¢®„Éâ„É™„Ç¢„ÅØÈâÑÊùø„ÇÇ„ÅæÔºÅ',
            '„Çπ„Ç∑„É≠„Éº„Åß10Áöø„Åü„Åπ„Çã„ÇÇ„ÅæÔΩûüç£',
            '„Çπ„Çø„Éê„ÅÆÊñ∞„É°„Éã„É•„Éº„ÄÅ„Åì„Å£„Åù„Çä„ÉÅ„Çß„ÉÉ„ÇØ„Åô„Çã„ÇÇ„ÅæÔºü',
            '‰ªäÊó•„ÅØ„Ç´„É¨„Éº„Éè„Ç¶„ÇπCoCoÂ£±Áï™Â±ã„Å´„Åó„Å°„ÇÉ„ÅÜ„ÇÇ„ÅæÔºüüçõ',
            'È§ÉÂ≠ê„ÅÆÁéãÂ∞Ü„Åß„ÇÆ„Éß„Éº„Ç∂„Å±„Åè„Å±„Åè„Åô„Çã„ÇÇ„ÅæÔºÅü•ü',
            '‰ªäÊó•„ÅØÂ•ÆÁô∫„Åó„Å¶Âèô„ÄÖËãë„ÅÆÁÑºËÇâÂºÅÂΩì„Å´„Åô„Çã„ÇÇ„Åæ...Ôºü‚ú®',
            '„É¢„Çπ„Éê„Éº„Ç¨„Éº„ÅÆ„ÉÜ„É™„É§„Ç≠„ÄÅ„É¨„Çø„Çπ„Åó„ÇÉ„Åç„Åó„ÇÉ„Åç„ÇÇ„Åæ„ÇàÔΩû',
            '„Å™„ÅãÂçØ„ÅÆË¶™Â≠ê‰∏º„ÄÅ„Åµ„Çè„Å®„Çç„ÇÇ„Åæ„Å≠„Åá',
            'Â§©‰∏ã‰∏ÄÂìÅ„ÅÆ„Åì„Å£„Å¶„Çä„É©„Éº„É°„É≥„ÄÅ„Åü„Åæ„Å´È£ü„Åπ„Åü„Åè„Å™„Çã„ÇÇ„ÅæÔºÅ',
            '„Ç±„É≥„Çø„ÉÉ„Ç≠„Éº„ÅÆ„Ç™„É™„Ç∏„Éä„É´„ÉÅ„Ç≠„É≥„ÄÅ„Çπ„Éë„Ç§„Çπ„Åç„ÅÑ„Å¶„Çã„ÇÇ„ÅæÔºÅüçó',
            'ÊùæÂ±ã„ÅÆÁâõ„ÇÅ„Åó„ÄÅÁ¥ÖÁîüÂßú„Åü„Å£„Å∑„Çä„ÅÆ„Åõ„Çã„ÇÇ„ÅæÔºÅ',
            '„Åô„ÅçÂÆ∂„ÅÆ„ÉÅ„ÉºÁâõ„ÄÅ„Å®„Çç„Å®„Çç„ÇÇ„ÅæÔΩûüßÄ',
            '„Ç¨„Çπ„Éà„ÅÆ„ÉÅ„Éº„Ç∫IN„Éè„É≥„Éê„Éº„Ç∞„ÄÅÂàá„Çã„Å®„Åò„ÇÖ„ÇèÔΩû„ÇÇ„ÅæÔºÅ',
            'ÂØåÂ£´„Åù„Å∞„Åß„Çµ„ÇØ„ÉÉ„Å®„Åä„Åù„Å∞È£ü„Åπ„Çã„ÇÇ„ÅæÔºü',
            'ÁÑºËÇâ„Åç„Çì„Åê„ÅßÈ£ü„ÅπÊîæÈ°åÔºÅ„Åä„Å™„Åã„ÅΩ„Çì„ÅΩ„Çì„ÇÇ„ÅæÔºÅ',
            'Â§ßÊà∏Â±ã„ÅÆÈªíÈÖ¢„ÅÇ„Çì„Åã„Åë„ÄÅÂÅ•Â∫∑„ÇÇ„Åæ„Å≠„Åá',
            '„ÇÑ„Çà„ÅÑËªí„Åß„Åä„Åã„Çè„ÇäÁÑ°Èôê„É´„Éº„Éó„ÇÇ„Åæ...ÔºÅüçö',
            '„ÅØ„Å™„Åæ„Çã„ÅÜ„Å©„Çì„ÅÆÊ∏©Áéâ„Å∂„Å£„Åã„Åë„ÄÅ„Å§„Çã„Å§„Çã„ÇÇ„ÅæÔΩû',
            'ÁØâÂú∞ÈäÄ„Å†„Åì„ÅÆ„Åü„ÅìÁÑº„Åç„ÄÅÂ§ñ„Ç´„É™‰∏≠„Éà„É≠„ÇÇ„Åæ„ÇàÔºÅüêôÔºàÊèö„ÅíÁÑº„Åç„Å£„Å¶„ÅÑ„ÅÜ„ÇÇ„ÅæÔºâ',
            '„Çµ„Éº„ÉÜ„Ç£„ÉØ„É≥„Åß„Éà„É™„Éó„É´„Ç¢„Ç§„Çπ„Å´„Åó„Å°„ÇÉ„ÅÜ„ÇÇ„ÅæÔºÅÔºüüç®',
            '‰∏ÄËò≠„ÅßÈõÜ‰∏≠„Åó„Å¶„É©„Éº„É°„É≥„Åü„Åπ„Çã„ÇÇ„Åæ...üçú',
            'ÁâõËßí„ÅßÁ∂≤ÁÑº„Åç„Éë„Éº„ÉÜ„Ç£„ÇÇ„ÅæÔºÅ„Åò„ÇÖ„Éº„Åò„ÇÖ„ÉºÔºÅüî•',
            '„Å§„Çã„Å®„Çì„Åü„Çì„ÅÆÂ§ß„Åç„Å™Âô®„ÄÅ„Å≥„Å£„Åè„Çä„Åô„Çã„ÇÇ„Åæ„Å≠',
            '„Éü„Çπ„Çø„Éº„Éâ„Éº„Éä„ÉÑ„Åß„Éù„É≥„Éª„Éá„Éª„É™„É≥„Ç∞10ÂÄã„Åü„Åπ„Çã„ÇÇ„ÅæÔºÅüç©',
            '„Åô„ÅçÂÆ∂„ÅÆÈ´òËèú„ÇÅ„Çì„Åü„ÅÑÁâõ‰∏º„ÄÅ„Éî„É™Ëæõ„ÅßÊúÄÈ´ò„ÇÇ„ÅæÔºÅ',
            'ÂÆü„ÅØ„Çπ„Çø„Éê„Åß„ÅÑ„Å£„Å°„Å∞„Çì„Åä„ÅÑ„Åó„ÅÑ„ÅÆ„Å£„Å¶„Ç¶„Éº„É≠„É≥Ëå∂„ÇÇ„Åæ'
        ];

        function selectTopic(topic, isAuto = false) {
            if (isAuto && topic === '„Å™„Å´È£ü„Åπ„Çà„Å£„ÅãÔΩû') {
                topicMenu.style.display = 'none';
                const suggestion = mealSuggestions[Math.floor(Math.random() * mealSuggestions.length)];
                showBubble(suggestion);
                return;
            }
            currentTopic = topic;
            menuTopics.style.display = 'none';
            menuInput.style.display = 'flex';
            menuInstruction.innerText = `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„Åä„Åó„Åà„Å¶ÔºÅ`;
            userInput.focus();
        }

        function closeChat(e) {
            topicMenu.style.display = 'none';
        }

        const topicContexts = {
            '„Åä„ÇÑ„Å§': ['„Åä„ÅÑ„Åó„Åù„ÅÜÔºÅ', '„ÇÇ„Åæ„ÇÇ„Åü„Åπ„Åü„ÅÑÔºÅ', '„Åä„ÇÑ„Å§„Çø„Ç§„É†„Å†„Å≠‚ú®'],
            '„Åä„ÅÑ„Åó„ÅÑ„ÇÇ„ÅÆ': ['„Çà„Å†„Çå„Åå„Åß„Å°„ÇÉ„ÅÜ...ü§§', '„ÅÑ„ÅÑ„Å™„ÅÅÔΩûÔºÅ', '„Åì„Çì„Å©„ÅÑ„Å£„Åó„Çá„Å´„Åü„Åπ„ÇàÔºü'],
            '„Åì„Çå„Åô„Åç': ['„Åù„Çå„ÄÅ„ÇÇ„Åæ„ÇÇ„Åô„ÅçÔºÅ', '„Éè„ÉÉ„Éî„Éº„Å´„Å™„Çå„Çã„Å≠‚ú®', '„Åô„Å¶„Åç„Å†„Å≠„Åá üíï'],
            '„Å§„Åæ„Çì„Å™„ÅÑ': ['„Åù„Çì„Å™„Å®„Åç„ÅØ„ÄÅ„Åä„Å©„ÇäÊòé„Åã„Åù„ÅÜÔºÅüï∫', '„ÇÇ„Åæ„ÅåÁ¨ë„Çè„Åõ„Å¶„ÅÇ„Åí„ÇãÔºÅ', '„ÅÆ„Çì„Å≥„Çä„Åó„Çà„Å£„Åãüí§'],
            '„Åü„ÅÆ„ÅóÔΩû': ['„Çè„Éº„ÅÑÔºÅÊúÄÈ´ò„Å†„Å≠ÔºÅ‚ú®', '„ÇÇ„Å£„Å®„ÇÇ„Å£„Å®„Åü„ÅÆ„Åó„ÇÇ„ÅÜÔºÅ', '„Éè„ÉÉ„Éî„Éº„Éè„ÉÉ„Éî„ÉºÔºÅ'],
            '„Åì„Çè„ÅÑ': ['„ÇÇ„Åæ„Åå„Åä„Å∞„Åë„Çí„ÇÑ„Å£„Å§„Åë„ÇãÔºÅ‚öîÔ∏è', 'Â§ß‰∏àÂ§´„ÄÅ„ÅÑ„Å£„Åó„Çá„Å´„ÅÑ„Çã„Çàüíß', '„Åé„ÇÖ„Éº„Å£„Å¶„Åó„Å¶„ÅÇ„Åí„ÇãÔºÅ'],
            '„Åç„ÅÑ„Å¶ÔºÅ': ['„ÅÜ„Çì„ÅÜ„Çì„ÄÅ„Åù„Çå„Åß„Åù„Çå„ÅßÔºüüì¢', '„Å≥„Å£„Åè„Çä„Åó„Å°„ÇÉ„ÅÜ„Å≠ÔºÅ', '„Åô„Åî„ÅÑ„ÅäË©±„Å†ÔΩûÔºÅ‚ú®'],
            '„Åä„Åï„Çì„ÅΩ': ['„Åä„Åï„Çì„ÅΩ„Å†„ÅÑ„Åô„ÅçÔºÅüêæ', '„Å©„Åì„Åæ„Åß„ÅÑ„Åì„ÅÜ„ÅãÔºü', '„Åó„Å£„ÅΩÊåØ„Å£„Å°„ÇÉ„ÅÜ‚ô™'],
            '„Å†„ÅÑ„Åô„Åç': ['„ÇÇ„Åæ„ÇÇ„Åõ„Åã„ÅÑ„ÅÑ„Å°„Å†„ÅÑ„Åô„ÅçÔºÅÔºÅüíï', '„Åö„Å£„Å®„ÅÑ„Å£„Åó„Çá„Å´„ÅÑ„Çà„ÅÜ„Å≠///', '„Å°„ÇÖ„Å£ÔºÅ‚ú®'],
            '„Å™„ÅÑ„Åó„ÇáË©±': ['„ÇÇ„Åæ„ÄÅÂè£„Åã„Åü„ÅÑ„Çàü§´', '„Åµ„ÇÄ„Åµ„ÇÄ...ÁßòÂØÜ„Å†„Å≠‚ú®', '„Éâ„Ç≠„Éâ„Ç≠„Åó„Å°„ÇÉ„ÅÜ„Å≠ÔºÅ'],
            '„Åä„Å™„Åã„Å∏„Å£„Åü': ['„Åê„ÅÖÔΩû„Å£„Å¶„Åä„Å™„Åã„Å™„Å£„Å°„ÇÉ„ÅÜ„Å≠üçö', '„Å™„Å´„Åã„Å§„Åè„ÇãÔºÅÔºü', '„Åî„ÅØ„Çì„ÅÆ„Åò„Åã„Çì„Å†„ÉºÔºÅ']
        };

        function sendChat() {
            const text = userInput.value.trim();
            if (!text) return;

            topicMenu.style.display = 'none';
            userInput.value = '';

            showBubble('...');

            setTimeout(() => {
                const contextOptions = topicContexts[currentTopic] || ['„ÅÜ„Çì„ÅÜ„ÇìÔºÅ'];
                const response = contextOptions[Math.floor(Math.random() * contextOptions.length)];
                showBubble(response);

                if (Math.random() < 0.4) {
                    moma.classList.add('animate-bounce');
                    setTimeout(() => moma.classList.remove('animate-bounce'), 1000);
                }
            }, 800);
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendChat();
            }
        }

        function processSelectedTopicResponse(topic) { // Renamed from original selectTopic
            topicMenu.style.display = 'none';
            const possibleResponses = topicContexts[topic]; // Use topicContexts
            const text = possibleResponses[Math.floor(Math.random() * possibleResponses.length)];

            showBubble(text);

            // Random reaction pose
            if (topic === '„Åä„ÇÑ„Å§' || topic === '„Åü„ÅÆ„ÅóÔΩû') {
                moma.classList.add('animate-bounce');
                setTimeout(() => moma.classList.remove('animate-bounce'), 1000);
            }
        }

        let bubbleTimer = null;
        function showBubble(text) {
            if (bubbleTimer) clearTimeout(bubbleTimer);

            momaBubble.innerText = text;
            momaBubble.style.display = 'block';

            // Position bubble above Moma
            updateBubblePosition();

            // Hide after a while
            bubbleTimer = setTimeout(() => {
                momaBubble.style.display = 'none';
                bubbleTimer = null;
            }, 5000);
        }

        function updateBubblePosition() {
            if (momaBubble.style.display === 'block') {
                momaBubble.style.left = (momaX + 125 - momaBubble.offsetWidth / 2) + 'px';
                momaBubble.style.top = (momaY - momaBubble.offsetHeight - 20) + 'px';
            }
        }

        // Update bubble on move
        const originalUpdatePosition = updatePosition;
        updatePosition = function () {
            originalUpdatePosition();
            updateBubblePosition();
        };

        function createHeart(x, y, char = "‚ù§Ô∏è") {
            const heart = document.createElement('div');
            heart.classList.add('heart-bubble');
            heart.innerText = char;
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        // Handle Window Resize
        window.addEventListener('resize', () => {
            width = container.offsetWidth;
            height = container.offsetHeight;
        });
    </script>
</body>

</html>